% !TeX root = ..\..\thesis.tex
\chapter{Approach}
\label{sec:approach}


\section{Data Collection}
\label{sec:approach:data_collection}


\section{Architecture and Models used}
\label{sec:approach:architecture_models}

\subsection{Architecture}
\label{sec:approach:architecture_models:architecture}

\subsection{Models}
\label{sec:approach:architecture_models:models}

\begin{itemize}
  \item Llama3.2
  \item Sentence Transformer
  \item DeBERTa
  \item \ldots
\end{itemize}


\section{Evaluation Metrics}
\label{sec:approach:evaluation_metrics}


\section{Style Sentence Generation}
\label{sec:approach:style_sentence_generation}

The style sentences that form the dimensions of the interpretable style vector are generated by prompting a \acl{llm} in a two-step procedure.

For step one, the \ac{llm} is presented with a zero-shot prompt to produce a description of the text. This step is repeated 92 times, each time with a different prompt that focuses on a specific aspect of the text. 6 prompts are relatively open and only give a loose direction on which style should be described by the model. 84 prompts are targeted towards an explicit stylistic feature. These prompts follow the work of \citet{patelLearningInterpretableStyle2023,tausczikPsychologicalMeaningWords2010} to get the model to focus on a broad variety of style that is important for the study of language.

In addition to these prompts aimed at stylistic features, there are two prompts which are focusing on the knowledge and experience of the author. While the background knowledge of the author is not as important for the group membership detection as the style of the text, it is helpful information for the steering task that is covered in later sections.

After generating the style descriptions, the \ac{llm} is prompted a second time to rewrite the description as a list of sentences. The model is instructed to write each sentence in a consistent form like \enquote{The author is \ldots} or \enquote{The author uses \ldots}.

Furthermore, the model is instructed to avoid negations and examples since these both lead to increasing problems with the clustering process that is described in Section~\ref{sec:approach:clustering}.
Sentences that include examples are potentially problematic because it increases the likelihood of sentences which have the exact same content while being of different shape. % TODO: better wording
Two sentences which differ only in the example are \enquote{The author uses filler words'} and \enquote{The author uses filler words such as 'and', 'or' and 'furthermore'}. While this problem will be reduced by clustering similar sentences, this procedure is not perfect and will be more robust if the model avoids sentences with examples.

Negations on the other hand lead to the problem where the shape of the sentences will be too close while the content is very different. There is a high chance that the sentences \enquote{The author does use long sentences} and \enquote{The author does not use long sentences} will be clustered together because so much of them is the same even though they state the opposite of each other.
Additionally, the dimensions of the final style vector should not include any negated attributes since the expression \enquote{The author uses short sentences} is much clearer than \enquote{The author does not use long sentences}.

Since the model might produce sentences with negations or examples despite the prompt, each of the generated sentences is checked automatically.

Per description, each distinct style sentence is recorded only once, even if the model generates it multiple times. This is done in case the model generates a bad answer where one sentence is repeated many times.

The whole process can be seen in Figure~\ref{fig:style_sentence_generation}.

\begin{figure}[ht]
  \input{figures/tikz/style_sentence_generation.tex}
  % TODO: better caption
  \caption{The process to generate style sentences.}
  \label{fig:style_sentence_generation}
\end{figure}


\section{Clustering}
\label{sec:approach:clustering}

\begin{itemize}
  \item often, style sentences are generated that are very similar
  \item e.g. \enquote{The author uses short and concise sentences.} and \enquote{The author uses concise and short sentences.}
  \item If one style sentence is used very often but in many different variations, it may not get selected for the style sentence vector because each variation by itself has not occured often enough
  \item The sentences are embedded with the model x % TODO: write that here?
  \item because of that, all style sentences are clustered so that sentences which embeddings have a cosine distance of less than 0.15 count as the same sentence. The sentence that is closest to the center functions as the representation of the whole cluster
  \item each sentence can only be in one cluster; if it is in multiple clusters it is removed from all but the largest
  \item each sentence has to be in exactly one clusters, so many clusters include only one sentence
\end{itemize}


\section{Selecting the Style Vector Attributes}
\label{sec:approach:selection}

\begin{itemize}
  \item the vector has 768 dimensions, the attributes are selected automatically
  \item a attribute may only be used in a maximum of \SI{60}{\percent} of the groups
        \begin{itemize}
          \item otherwise it is not well suited to distinguish between the groups
        \end{itemize}
  \item often, the same attribute was used multiple times to describe the same input text
        \begin{itemize}
          \item multiple prompts produce the same attribute
          \item if one prompt produces one attribute multiple times, it is only saved one time
          \item for further computation, only unique attributes are used
        \end{itemize}
\end{itemize}


\section{Testing and Training \acs{sfam}}
\label{sec:approach:sfam}

\begin{itemize}
  \item Selection of training data
        \begin{itemize}
          \item in the original paper of \textcite{patelLearningInterpretableStyle2023}, they have done it this way \ldots
          \item I select the negativ training examples through the similarity style vector
        \end{itemize}
\end{itemize}


\section{Testing and Training \acs{lisa}}
\label{sec:approach:lisa}


\section{Possible Improvement through Knowledge Attributes}
\label{sec:approach:knowledge_attributes}


\section{Steering Text Generation with Simple Prompting}
\label{sec:approach:steering:simple}


\section{Steering Text Generation with Targeted Prompting}
\label{sec:approach:steering:targeted}


\section{Steering Text Generation with Activation Layer Manipulation}
\label{sec:approach:steering:actAdd}

\subsubsection{Extracting Steering Vectors}

\subsubsection{Generation Steering}